<%- include('partials/header', { title: 'Dashboard' }) %>
<%- include('partials/messages') %>

<div class="summary-container">
    <div class="stat-card">
        <h3>Total Users</h3>
        <p><%= totalUsers %></p>
    </div>
    <div class="stat-card">
        <h3>Collected This Month</h3>
        <p><%= totalCollected %></p>
    </div>
    <div class="stat-card">
        <h3>Unpaid Users</h3>
        <p><%= unpaidUsersCount %></p>
    </div>
</div>

<div class="content-section">
    <h2>Record a Payment</h2>
    <form action="/save-payment" method="post">
        <label for="userId">Select User:</label>
        <select name="userId" id="userId" required>
            <% if (typeof users !== 'undefined') { %>
                <% users.forEach(user => { %>
                    <option value="<%= user._id %>" data-fare="<%= user.fixedFare %>"><%= user.name %> - <%= user.location.name %></option>
                <% }); %>
            <% } %>
        </select>
        <br><br>
        <label for="amount">Amount:</label>
        <input type="number" name="amount" id="amount" required>
        <br><br>
        <button type="submit" class="btn">Save Payment</button>
    </form>
</div>

<div class="admin-actions">
    <form action="/mark-all-unpaid" method="post" onsubmit="return confirm('Are you sure you want to mark ALL users as unpaid? This cannot be undone.');">
        <button type="submit" class="btn btn-warning">Mark All Users as Unpaid</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const userSelect = document.getElementById('userId');
        const amountInput = document.getElementById('amount');

        // Function to update the amount based on the selected user
        function updateAmount() {
            const selectedOption = userSelect.options[userSelect.selectedIndex];
            if (selectedOption) {
                const fare = selectedOption.getAttribute('data-fare');
                if (fare) {
                    amountInput.value = fare;
                }
            }
        }

        // Add an event listener to the dropdown
        userSelect.addEventListener('change', updateAmount);

        // Set the initial value when the page loads
        updateAmount();
    });
</script>
<%- include('partials/footer') %>